# 《重生之凡人修仙传》网络文字游戏架构设计文档

## 1. 项目概述
本项目旨在构建一款基于B/S架构的纯网络文字修仙游戏，以《凡人修仙传》为题材背景，还原修真界的残酷与机缘。游戏强调数值成长、策略搭配与社交互动，采用极简的文字UI风格，辅以动态特效，营造沉浸式修仙体验。

## 2. 系统架构设计

### 2.1 整体架构
采用经典的 **B/S (Browser/Server)** 架构，前后端分离设计。
*   **客户端**: 浏览器（PC/Mobile适配），通过 HTTPS 与服务器通信。
*   **服务端**: RESTful API 服务，负责业务逻辑处理。
*   **数据层**: 关系型数据库 + 内存缓存。

### 2.2 技术选型
*   **后端语言**: 推荐使用 Node.js (Express/Koa/NestJS) 或 Python (Django/FastAPI) 或 Java (Spring Boot)。考虑到文字游戏的高并发I/O特性，Node.js 或 Go 是不错的选择。
*   **数据库 (持久层)**: **MySQL 5.6** (根据环境要求)。
    *   用于存储玩家核心数据、账号信息、日志等。
*   **缓存层**: **Redis** / Memcached。
    *   用于存储活跃玩家Session、高频访问的配置数据、排行榜、临时战斗状态。
*   **通信协议**: HTTPS (HTTP/1.1 或 HTTP/2)。部分实时性要求高的功能（如即时聊天、组队战斗）用 WebSocket。

### 2.3 部署环境
*   **操作系统**: Windows Server
*   **数据库连接**: 直连测试/生产数据库 数据库名:xiuxian，用户名:xiuxian，密码:aTDC3Ay5sPShJT88

## 3. 游戏界面布局设计

界面设计遵循“信息层级清晰、操作便捷、风格古朴暗黑”的原则。

### 3.1 左侧面板：角色信息区 (Player Status)
*   **基本属性**: 头像、昵称、境界（如：炼气期三层）、寿元（当前/上限）、灵力值。
*   **核心数值**: 攻击、防御、神识、速度、悟性、机缘。
*   **装备/法宝**: 展示当前装备的法宝，支持悬浮查看详情。
*   **功法/技能**: 当前修炼的主修功法、辅修秘术及技能树状态。
*   **储物袋**: 快捷物品栏，显示灵石数量、背包负重。

### 3.2 中央主区域：交互与反馈 (Main Interaction)
*   **动态事件反馈区**: 类似于控制台日志，实时滚动显示游戏行为结果。
    *   *示例*: "23:15:00 你潜心感悟大道，运转木心诀。（+41 修为）"
    *   *示例*: "23:15:10 打坐时获得 2 灵石。"
*   **场景视图**: 可切换的标签页或地图模式。
    *   **宗门**: 显示宗门大殿、任务阁、藏宝阁等。
    *   **秘境**: 显示探索进度、当前遭遇的怪物或事件。
    *   **坊市**: 交易列表。
*   **交互式文字描述**: 针对当前事件的详细文字描述（如战斗过程、剧情对话）。

### 3.3 底部功能区：操作栏 (Action Bar)
*   **基础修炼**: [闭关]、[历练]、[秘境]。
*   **生产技能**: [炼丹]、[炼器]、[制符]。
*   **探索/移动**: [地图]、[前往]。
*   **社交功能**: [宗门]、[好友]、[聊天]、[邮件]。
*   **系统**: [设置]、[公告]、[排行]。

## 4. 核心玩法系统

### 4.1 境界突破体系
*   **层级**: 炼气 -> 筑基 -> 结丹 -> 元婴 -> 化神 ...
*   **机制**: 
    *   积攒修为（Exp）达到瓶颈。
    *   需特定丹药（如筑基丹）辅助突破。
    *   突破概率受心魔、丹药品质、环境灵气浓度影响。
    *   失败可能导致修为倒退或重伤。

### 4.2 随机事件系统 (Roguelike元素)
*   **奇遇**: 游历时触发，可能获得古修洞府传承、捡到残宝。
*   **天劫**: 大境界突破时触发雷劫，需法宝抵挡。
*   **秘境探索**: 步数机制，每一步可能触发战斗、宝箱、陷阱或BUFF。

### 4.3 修真经济系统
*   **一般货币**: 灵石（低阶/中阶/高阶），用于坊市交易、NPC买卖。
*   **特殊货币**: 宗门贡献点（兑换宗门秘籍）、仙玉（充值/稀有掉落）。
*   **交易**: 玩家摆摊、拍卖行系统。

### 4.4 宗门与社交
*   **职位**: 外门弟子 -> 内门弟子 -> 真传 -> 长老 -> 宗主。
*   **互动**: 宗门任务（种植灵草、猎杀妖兽）、宗门战（抢夺资源点）。

### 4.5 生活技能
*   **炼丹**: 采集草药 -> 丹方 -> 丹炉火候控制 -> 成丹（分品质：下品/中品/上品/极品）。
*   **炼器**: 矿石精炼 -> 器胚 -> 刻画阵法 -> 成器。

## 5. 技术实现要求

### 5.1 后端实现
*   **API设计**: 使用 **Apifox** 进行接口定义与文档管理。
    *   `POST /api/player/meditate` (打坐)
    *   `POST /api/combat/start` (开始战斗)
    *   `GET /api/inventory/list` (获取背包)
*   **数据映射 (ORM)**: 使用 Sequelize (Node.js) 或 SQLAlchemy (Python) 或 MyBatis/Hibernate (Java) 进行对象关系映射，避免手写复杂SQL。
*   **事件队列**: 使用 Redis List 或 RabbitMQ 处理非实时高并发事件（如全服广播、日志写入）。
*   **定时任务**: 
    *   修为自动增长（挂机收益）。
    *   体力/精力恢复。
    *   拍卖行结算。

### 5.2 前端实现
*   **布局**: 响应式设计，适配 PC 宽屏与 手机竖屏。
*   **交互**: AJAX / Fetch 异步请求，无刷新更新数据。
*   **视觉**: 
    *   文字动画效果（打字机效果、伤害飘字）。
    *   CSS3 动画用于进度条流光、按钮点击反馈。
*   **状态管理**: Vuex / Pinia / Redux 管理玩家实时状态。

## 6. 数据模型设计 (Database Schema)

基于 MySQL 5.6。

### 6.1 玩家基础表 (`players`)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `player_id` | BIGINT (PK) | 玩家唯一ID |
| `username` | VARCHAR | 登录名 |
| `nickname` | VARCHAR | 游戏昵称 |
| `realm_level` | INT | 境界等级（数值对应具体境界） |
| `exp` | BIGINT | 当前修为 |
| `spirit_stones` | BIGINT | 灵石数量 |
| `lifespan_current`| INT | 当前年龄 |
| `lifespan_max` | INT | 最大寿元 |
| `created_at` | DATETIME | 创建时间 |

### 6.2 物品库存表 (`inventory`)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | BIGINT (PK) | 流水号 |
| `player_id` | BIGINT (FK) | 关联玩家 |
| `item_id` | INT | 物品模板ID |
| `count` | INT | 数量 |
| `durability` | INT | 耐久度/品质 |

### 6.3 属性/功法表 (`player_attributes`)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `player_id` | BIGINT (FK) | |
| `attack` | INT | 攻击力 |
| `defense` | INT | 防御力 |
| `active_art_id` | INT | 当前运转功法ID |

### 6.4 事件日志表 (`event_logs`)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `log_id` | BIGINT (PK) | |
| `player_id` | BIGINT (FK) | |
| `content` | TEXT | 日志内容 |
| `type` | TINYINT | 日志类型（战斗/收益/系统） |
| `created_at` | TIMESTAMP | 发生时间 |

## 7. 安全要求

*   **传输加密**: 强制使用 HTTPS 协议，防止中间人攻击窃取Token。
*   **防作弊**: 
    *   关键计算（战斗结果、掉落、强化）**必须在服务端完成**。
    *   前端仅负责展示，不信任前端传来的计算结果。
    *   API 接口添加签名验证 (Signature) 和重放攻击防护 (Nonce/Timestamp)。
*   **敏感操作保护**: 
    *   丢弃高价值物品、退出宗门等操作需二次确认。
    *   二级密码锁（针对背包/仓库）。
*   **审计日志**: 记录所有货币变更流水，便于追踪异常数据。

## 8. 扩展性设计

*   **模块化事件脚本**: 设计一套 JSON 或 Lua 格式的事件脚本引擎，策划可配置事件触发条件、对话内容、奖励掉落，无需修改代码重启服务器。
*   **公式配置化**: 伤害公式、修炼速度公式提取到配置文件或数据库配置表中。
*   **热更新**: 前端资源（图片、文本）通过 CDN 分发；后端逻辑尽可能微服务化或插件化（视规模而定），支持灰度发布。
*   **多语言**: 所有展示文本提取至 `Locales` 文件（i18n），为未来出海预留接口。
